function read(name,key){var cookieValue="";var search=name+"=";if(document.cookie.split("").length>0){offset=document.cookie.indexOf(search);if(offset!=-1){offset+=search.length;end=document.cookie.indexOf(";",offset);if(end==-1){end=document.cookie.split("").length}cookieValue=document.cookie.substring(offset,end)}}var a=cookieValue.split("&");var o={};var haveVal=false;for(var i=0,l=a.length;i<l;i++){var k=a[i].split("=");if(k[0]!=""){o[k[0]]=k[1];haveVal=true}}return haveVal?o:false}var common_header={init:function(){var _this=this;_this.herderUI();_this.navUI();_this.inputUI()},islogined:function(){var loginInfo=read("KuGoo");return loginInfo==""||loginInfo.toString()=="undefined"||loginInfo===false?false:true},herderUI:function(){var _this=this,login_in=document.getElementById("login_in"),login_btn=document.getElementById("login_btn"),login_out=document.getElementById("login_out"),user_menu=document.getElementById("user_menu"),menuT=null;if(_this.islogined()){var kugouC=read("KuGoo"),user_name=kugouC.NickName.replace(/%/g,"\\"),user=eval("'"+user_name+"'"),uer_img=kugouC.Pic;$("#login_in").hide();$(login_out).show();if(uer_img.indexOf("http")!=-1){$(login_out).find(".user_img").attr("src",uer_img)}else{$(login_out).find(".user_img").attr("src","http://imge.kugou.com/kugouicon/165/"+uer_img.substr(0,8)+"/"+uer_img)}$(login_out).find(".user_name").html(user)}else{$("#login_btn").on("click",function(e){$.ajax({url:"http://static.kgimg.com/common/js/min/popuplogin-min.js?"+Math.round((new Date).getTime()/1e3),dataType:"script",success:function(){UsLogin()}})})}login_out.onmouseover=function(){user_menu.style.cssText="display:block;"};login_out.onmouseleave=function(){menuT=setTimeout(function(){user_menu.style.display="none"},300)};login_out.onclick=function(){window.open("http://www.kugou.com/newuc/user/uc/")};user_menu.onmouseover=function(){clearTimeout(menuT);user_menu.style.cssText="display:block;"};user_menu.onmouseleave=function(){user_menu.style.cssText="display:none"}},navUI:function(){var t=null;var More=document.getElementById("more");var showMore=document.getElementById("showMore");var subUl=document.getElementById("secondMenu");showMore.onclick=function(){return false};More.onmouseover=function(){this.setAttribute("class","more hover");showMore.setAttribute("class","icon icon-nav6");subUl.style.cssText="display:block;"};More.onmouseleave=function(){this.setAttribute("class","more");showMore.setAttribute("class","icon icon-nav6");t=setTimeout(function(){subUl.style.display="none"},300)};subUl.onmouseover=function(){clearTimeout(t);More.setAttribute("class","more hover");showMore.setAttribute("class","icon icon-nav6");subUl.style.cssText="display:block;"};subUl.onmouseleave=function(){More.setAttribute("class","more");showMore.setAttribute("class","icon icon-nav6");subUl.style.cssText="display:none"}},delHtmlTag:function(str){return str.replace(/<[^>]+>/g,"")},htmlEncode:function(str){var s="";if(str.length==0)return s;s=s.replace(/<[^>]+>/g,"");s=str.replace(/\</g,"&lt;");s=s.replace(/\>/g,"&gt;");s=s.replace(/\'/g,"&#39;");s=s.replace(/\"/g,"&quot;");s=s.replace(/ /g,"&nbsp;");return s},inputUI:function(){var _this=this,$searh_btn=$(".searh_btn"),$top_history=$(".top_search_histroy"),$top_search_recommend=$(".top_search_recommend"),$top_searchInput=$(".top_search .search_input input"),topTime=null,wordRecommendTime=null,comfrom="",downFlag=1,upFlag=2,defaultFlag=false;$top_history.on("click",".clear_histroy",function(){localStorage["s_keyword"]="";$top_history.find(".history_song_list").empty();$top_history.removeClass("show").addClass("hide")});_this.nofouce(function(data){defaultFlag=true;if(!$.isEmptyObject(data)&&typeof data!="undefined"&&data!=""&&data.length!=0&&data[0]!="undefined"&&data[0]["keyword"]!="undefined"){if(_this.hasPlaceholder()){$top_searchInput.attr("placeholder",data[0]["keyword"])}else{$top_searchInput.val(data[0]["keyword"])}}});$searh_btn.on("click",function(){var type=$top_searchInput.attr("data")||"song",keyword=$top_searchInput.val().replace(/(^\s+)|(\s+$)/g,"");if(keyword==""){keyword=$top_searchInput.attr("placeholder")||""}_this.keywordStorge(keyword);location.replace("http://www.kugou.com/yy/html/search.html#searchType=song&searchKeyWord="+encodeURIComponent(keyword))});$top_searchInput.on("keydown",function(e){var keyword=$top_searchInput.val().replace(/(^\s+)|(\s+$)/g,""),histroydd=$(".top_search_histroy dd"),songdd=$(".top_search_recommend dl.recommend_song_list dd"),mvdd=$(".top_search_recommend dl.recommend_mv_list dd"),histroyIndex=$(".top_search_histroy dd.hover").index(),songIndex=$(".top_search_recommend .recommend_song_list dd.hover").index(),MvIndex=$(".top_search_recommend .recommend_mv_list dd.hover").index();if(e.keyCode===13){var type=$top_searchInput.attr("data"),keyword=$top_searchInput.val().replace(/(^\s+)|(\s+$)/g,"");location.replace("http://www.kugou.com/yy/html/search.html#searchType=song&searchKeyWord="+encodeURIComponent(keyword))}else if(e.keyCode==38){if(songIndex!=-1){upFlag=1}else{upFlag=2}if($top_history.hasClass("show")){if(histroyIndex+1==0){histroydd.eq(histroydd.length-1).addClass("hover").siblings("dd").removeClass("hover")}else{histroydd.eq(histroyIndex-1).addClass("hover").siblings("dd").removeClass("hover")}}else if($top_search_recommend.hasClass("show")){if(mvdd.length==0&&songdd.length!=0){upFlag=1;if(songIndex+1==0){upFlag=1;songdd.removeClass("hover");songdd.eq(songdd.length-1).addClass("hover")}else{upFlag=1;songdd.removeClass("hover");songdd.eq(songIndex-1).addClass("hover")}}if(songdd.length==0&&mvdd.length!=0){upFlag=2;if(MvIndex+1==0){songdd.removeClass("hover");mvdd.eq(mvdd.length-1).addClass("hover")}else{mvdd.removeClass("hover");mvdd.eq(MvIndex-1).addClass("hover")}}if(songdd.length!=0&&mvdd.length!=0){if(upFlag==1){if(songIndex==0){upFlag=2;songdd.removeClass("hover");mvdd.eq(mvdd.length-1).addClass("hover")}else{songdd.removeClass("hover");songdd.eq(songIndex-1).addClass("hover")}}else{if(MvIndex+1==0){songdd.removeClass("hover");mvdd.eq(mvdd.length-1).addClass("hover")}else{if(MvIndex==0){upFlag=1;mvdd.removeClass("hover");songdd.eq(songdd.length-1).addClass("hover")}else{mvdd.removeClass("hover");mvdd.eq(MvIndex-1).addClass("hover")}}}}}if($top_history.hasClass("show")){$top_searchInput.val($(".search_histroy dd.hover").attr("title"))}else if($top_search_recommend.hasClass("show")){if(upFlag==1){$top_searchInput.val($(".top_search_recommend .recommend_song_list dd.hover").attr("title")).attr("data","song")}else{$top_searchInput.val($(".top_search_recommend .recommend_mv_list dd.hover").attr("title")).attr("data","mv")}}}else if(e.keyCode==40){if($top_history.hasClass("show")){if(histroyIndex+1==histroydd.length){histroydd.eq(0).addClass("hover").siblings("dd").removeClass("hover")}else{histroydd.eq(histroyIndex+1).addClass("hover").siblings("dd").removeClass("hover")}}else if($top_search_recommend.hasClass("show")){if(mvdd.length==0&&songdd.length!=0){downFlag=1;if(songIndex+1==songdd.length){songdd.removeClass("hover");songdd.eq(0).addClass("hover")}else{songdd.removeClass("hover");songdd.eq(songIndex+1).addClass("hover")}}if(songdd.length==0&&mvdd.length!=0){downFlag=2;if(MvIndex+1==songdd.length){mvdd.removeClass("hover");mvdd.eq(0).addClass("hover")}else{mvdd.removeClass("hover");mvdd.eq(MvIndex+1).addClass("hover")}}if(songdd.length!=0&&mvdd.length!=0){if(downFlag==1){if(songIndex+1==0){mvdd.removeClass("hover");songdd.eq(0).addClass("hover")}else{if(songIndex+1==songdd.length){downFlag=2;songdd.removeClass("hover");mvdd.eq(0).addClass("hover")}else{songdd.removeClass("hover");songdd.eq(songIndex+1).addClass("hover")}}}else{if(MvIndex+1==mvdd.length){downFlag=1;mvdd.removeClass("hover");songdd.eq(0).addClass("hover")}else{mvdd.removeClass("hover");mvdd.eq(MvIndex+1).addClass("hover")}}}}if($top_history.hasClass("show")){$top_searchInput.val($(".search_histroy dd.hover").attr("title"))}else if($top_search_recommend.hasClass("show")){if(downFlag==1){$top_searchInput.val($(".top_search_recommend .recommend_song_list dd.hover").attr("title")).attr("data","song")}else{$top_searchInput.val($(".top_search_recommend .recommend_mv_list dd.hover").attr("title")).attr("data","mv")}}}}).on("click",function(){defaultFlag=false;_this.displayTip()}).on("textchange",function(){if(!defaultFlag){_this.displayTip()}}).on("blur",function(){topTime=setTimeout(function(){if(!$top_history.hasClass("noData")){$top_history.addClass("hide").removeClass("show")}$top_search_recommend.addClass("hide").removeClass("show")},400)});$top_history.mouseover(function(){clearTimeout(topTime);$top_history.removeClass("hide").addClass("show")});$top_history.on("mousedown","dd",function(){var keyword=$(this).text();$top_searchInput.val(keyword);location.replace("http://www.kugou.com/yy/html/search.html#searchType=song&searchKeyWord="+encodeURIComponent(keyword));$top_history.removeClass("show").addClass("hide");return false});$top_search_recommend.mouseover(function(){clearTimeout(topTime);$top_history.removeClass("hide").addClass("show")});$(".top_search_recommend").on("mousedown","dd",function(e){e.stopPropagation();e.preventDefault();var keyword=$(this).text();$top_searchInput.val(keyword);_this.keywordStorge(keyword);location.replace("http://www.kugou.com/yy/html/search.html#searchType="+$(this).attr("data-type")+"&searchKeyWord="+encodeURIComponent(keyword));$top_search_recommend.removeClass("show").addClass("hide");return false})},nofouce:function(callback){jQuery.support.cors=true;$.ajax({type:"GET",url:"http://so.service.kugou.com/v1/word_nofocus?platform=pc",dataType:"jsonp",success:function(res){if(res["status"]==1){callback(res["data"])}else{callback("")}},error:function(res){callback("")}})},displayTip:function(){var _this=this,$top_history=$(".top_search_histroy"),$top_search_recommend=$(".top_search_recommend"),$top_searchInput=$(".top_search .search_input input"),topTime=null,wordRecommendTime=null;if($top_searchInput.val()!=""){$top_history.addClass("hide").removeClass("show").hide();clearTimeout(wordRecommendTime);wordRecommendTime=setTimeout(function(){_this.wordRecommend({keyword:$top_searchInput.val(),callback:function(str){if(str!=""){$top_search_recommend.html(str).addClass("show").removeClass("hide").show()}}})},10)}else{$top_search_recommend.addClass("hide").removeClass("show").hide();_this.historyHtml(function(str){if(str!=""){$top_history.html(str).addClass("show").removeClass("hide").show()}else{$top_history.addClass("noData")}})}},wordRecommend:function(options){var defaults={keyword:"",MusicTipCount:5,MVTipCount:2,albumcount:2},_this=this;var op=$.extend(defaults,options);$.ajax({type:"GET",url:"http://searchtip.kugou.com/getSearchTip?MusicTipCount=5&MVTipCount=2&albumcount=2&keyword="+encodeURIComponent(op.keyword),crossDomain:true,dataType:"jsonp",success:function(res){if(res["status"]==1){if(res["data"]){var recommendhtml=_this.RecommendHtml(res["data"],op.keyword);options.callback(recommendhtml)}}else{options.callback("")}},error:function(res){options.callback("")}})},RecommendHtml:function(wordData,keyword){try{var recommendSongstr="<dl class='recommend_song_list recommend_list'>";var recommendMvstr="<h4><span class='icon_arrow'></span>MV</h2><dl class='recommend_mv_list recommend_list'>",songData=null,mvData=null;if(wordData[0]){songData=wordData[0].RecordDatas}if(wordData[1]){mvData=wordData[1].RecordDatas}if(songData.length==0){recommendSongstr=""}else{for(var i=0,Songlen=songData.length;i<Songlen;i++){var matchText="/"+keyword+"/";var textem=songData[i]["HintInfo"].replace(eval(matchText),"<em>"+keyword+"</em>");recommendSongstr+="<dd data-type='song' title='"+_this.htmlEncode(songData[i]["HintInfo"])+"'>"+textem+"</dd>"}recommendSongstr+="</dl>"}if(mvData.length==0){return recommendSongstr}else{for(var j=0,Mvlen=mvData.length;j<Mvlen;j++){var matchText="/"+keyword+"/";var textem=mvData[j]["HintInfo"].replace(eval(matchText),"<em>"+keyword+"</em>");recommendMvstr+="<dd data-type='mv' title='"+_this.htmlEncode(mvData[j]["HintInfo"])+"'>"+textem+"</dd>"}recommendMvstr+="</dl>"}return recommendSongstr+recommendMvstr}catch(ex){}},historyHtml:function(callback){var _this=this;var historyData;if(localStorage["s_keyword"]!=""&&typeof localStorage["s_keyword"]!="undefined"){historyData=localStorage["s_keyword"].split("|").reverse()}if(typeof historyData!="undefined"){if(historyData.length==0){callback("")}else{var historyStr="<dl class='history_song_list'>";for(var i=0,len=historyData.length;i<len;i++){historyStr+="<dd>"+_this.htmlEncode(decodeURI(historyData[i]))+"</dd>"}historyStr+="</dl><dl class='clear_histroy'><dt>清空历史记录</dt></dl>";callback(historyStr)}}else{return}},hasPlaceholder:function(){var attr="placeholder";var input=document.createElement("input");return attr in input},keywordStorge:function(keyword){keyword=keyword.replace(/(^\s+)|(\s+$)/g,"");if(keyword==""){return}var historyData=[],_this=this,i,len,deleteflag=false,deleteindex,limitLen=5;if(localStorage["s_keyword"]!=""&&typeof localStorage["s_keyword"]!="undefined"){historyData=localStorage["s_keyword"].split("|")}for(i=0,len=historyData.length;i<len;i++){if(historyData[i]==encodeURI(keyword)){deleteflag=true;deleteindex=i}}if(deleteflag){historyData.splice(deleteindex,1)}if(historyData.length>=limitLen){historyData=historyData.slice(historyData.length-4,historyData.length)}historyData.push(encodeURI(keyword));localStorage["s_keyword"]=historyData.join("|")},unique:function(arr){var tmpArr=[],hash={};for(var i=0;i<arr.length;i++){if(!hash[arr[i]]){hash[arr[i]]=true;tmpArr.push(arr[i])}}return tmpArr}};$(document).ready(function(){$.jStorage.set("playdata",null);common_header.init()});window.onerror=function(msg,url,lineNo,columnNo,error){console.log(msg);console.log(url);console.log(lineNo);console.log(columnNo);console.log(error)};